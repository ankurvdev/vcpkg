From c7c1a38c0cd1629a70e3a02a138268928caebb79 Mon Sep 17 00:00:00 2001
From: ankurv <ankurv@microsoft.com>
Date: Wed, 9 Jun 2021 13:57:19 -0700
Subject: [PATCH] patch

---
 CMakeLists.txt     | 16 ++++++++++++----
 src/rtl_tcp.c      |  1 +
 3 files changed, 13 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 2def354..dab7b4c 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -66,18 +66,26 @@ endif()
 ########################################################################
 # Find build dependencies
 ########################################################################
+if(MSVC)
+find_package(pthreads)
+include_directories(${PThreads4W_INCLUDE_DIR})
+else()
 if(WIN32 AND NOT MINGW)
     set(THREADS_USE_PTHREADS_WIN32 true)
 endif()
 find_package(Threads)
-find_package(PkgConfig)
-pkg_check_modules(LIBUSB libusb-1.0 IMPORTED_TARGET)
+if(NOT THREADS_FOUND)
+    message(FATAL_ERROR "pthreads(-win32) required to compile rtl-sdr")
+endif()
+endif()

+find_package(libusb)
+include_directories(${LIBUSB_INCLUDE_DIRS})
 if(NOT LIBUSB_FOUND)
     message(FATAL_ERROR "LibUSB 1.0 required to compile rtl-sdr")
 endif()
-if(NOT THREADS_FOUND)
-    message(FATAL_ERROR "pthreads(-win32) required to compile rtl-sdr")
+if(NOT WIN32 AND NOT ANDROID)
+    list(APPEND LIBUSB_LIBRARIES udev)
 endif()

 ########################################################################
diff --git a/src/rtl_tcp.c b/src/rtl_tcp.c
index 562198f..b4bfa51 100644
--- a/src/rtl_tcp.c
+++ b/src/rtl_tcp.c
@@ -35,6 +35,7 @@
 #include <fcntl.h>
 #else
 #include <winsock2.h>
+#include <ws2tcpip.h>
 #include "getopt/getopt.h"
 #endif

--
2.29.2.windows.3

